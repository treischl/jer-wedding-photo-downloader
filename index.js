const exec = require("child_process").exec;
const fs = require("fs");
const http = require("http");
const url = require("url");

const URL_BASE =
	"https://az415828.vo.msecnd.net/pictures/12/122/12122243/lowres";
const DOWNLOAD_DIR = ".\\photos";

const photoIds = [
	552417480,
	552417481,
	552417482,
	552417483,
	552417484,
	552417485,
	552417486,
	552417487,
	552417488,
	552417489,
	552417490,
	552417491,
	552417492,
	552417493,
	552417494,
	552417495,
	552417496,
	552417497,
	552417498,
	552417499,
	552417500,
	552417501,
	552417502,
	552417503,
	552417504,
	552417505,
	552417506,
	552417507,
	552417508,
	552417509,
	552417510,
	552417511,
	552417512,
	552417513,
	552417514,
	552417515,
	552417516,
	552417517,
	552417518,
	552417519,
	552417520,
	552417521,
	552417522,
	552417523,
	552417524,
	552417525,
	552417526,
	552417527,
	552417528,
	552417529,
	552417530,
	552417531,
	552417532,
	552417533,
	552417534,
	552417535,
	552417536,
	552417537,
	552417538,
	552417539,
	552417540,
	552417541,
	552417542,
	552417543,
	552417544,
	552417545,
	552417546,
	552417547,
	552417548,
	552417549,
	552417550,
	552417551,
	552417552,
	552417553,
	552417554,
	552417555,
	552417556,
	552417557,
	552417558,
	552417559,
	552417560,
	552417561,
	552417562,
	552417563,
	552417564,
	552417565,
	552417566,
	552417567,
	552417568,
	552417569,
	552417570,
	552417571,
	552417572,
	552417573,
	552417574,
	552417575,
	552417576,
	552417577,
	552417578,
	552417579,
	552417580,
	552417581,
	552417582,
	552417583,
	552417584,
	552417585,
	552417586,
	552417587,
	552417588,
	552417589,
	552417590,
	552417591,
	552417592,
	552417593,
	552417594,
	552417595,
	552417596,
	552417597,
	552417598,
	552417599,
	552417600,
	552417601,
	552417602,
	552417603,
	552417604,
	552417605,
	552417606,
	552417607,
	552417608,
	552417609,
	552417610,
	552417611,
	552417612,
	552417613,
	552417614,
	552417615,
	552417616,
	552417617,
	552417618,
	552417619,
	552417620,
	552417621,
	552417622,
	552417623,
	552417624,
	552417625,
	552417626,
	552417627,
	552417628,
	552417629,
	552417630,
	552417631,
	552417632,
	552417633,
	552417634,
	552417635,
	552417636,
	552417637,
	552417638,
	552417639,
	552417640,
	552417641,
	552417642,
	552417643,
	552417644,
	552417645,
	552417646,
	552417647,
	552417648,
	552417649,
	552417650,
	552417651,
	552417652,
	552417653,
	552417654,
	552417655,
	552417656,
	552417657,
	552417658,
	552417659,
	552417660,
	552417661,
	552417662,
	552417663,
	552417664,
	552417665,
	552417666,
	552417667,
	552417668,
	552417669,
	552417670,
	552417671,
	552417672,
	552417673,
	552417674,
	552417675,
	552417676,
	552417677,
	552417678,
	552417679,
	552417680,
	552417681,
	552417682,
	552417683,
	552417684,
	552417685,
	552417686,
	552417687,
	552417688,
	552417689,
	552417690,
	552417691,
	552417692,
	552417693,
	552417694,
	552417695,
	552417696,
	552417697,
	552417698,
	552417699,
	552417700,
	552417701,
	552417702,
	552417703,
	552417704,
	552417705,
	552417706,
	552417707,
	552417708,
	552417709,
	552417710,
	552417711,
	552417712,
	552417713,
	552417714,
	552417715,
	552417716,
	552417717,
	552417718,
	552417719,
	552417720,
	552417721,
	552417722,
	552417723,
	552417724,
	552417725,
	552417726,
	552417727,
	552417728,
	552417729,
	552417730,
	552417731,
	552417732,
	552417733,
	552417734,
	552417735,
	552417736,
	552417737,
	552417738,
	552417739,
	552417740,
	552417741,
	552417742,
	552417743,
	552417744,
	552417745,
	552417746,
	552417747,
	552417748,
	552417749,
	552417750,
	552417751,
	552417752,
	552417753,
	552417754,
	552417755,
	552417756,
	552417757,
	552417758,
	552417759,
	552417760,
	552417761,
	552417762,
	552417763,
	552417764,
	552417765,
	552417766,
	552417767,
	552417768,
	552417769,
	552417770,
	552417771,
	552417772,
	552417773,
	552417774,
	552417775,
	552417776,
	552417777,
	552417778,
	552417779,
	552417780,
	552417781,
	552417782,
	552417783,
	552417784,
	552417785,
	552417786,
	552417787,
	552417788,
	552417789,
	552417790,
	552417791,
	552417792,
	552417793,
	552417794,
	552417795,
	552417796,
	552417797,
	552417798,
	552417799,
	552417800,
	552417801,
	552417802,
	552417803,
	552417804,
	552417805,
	552417806,
	552417807,
	552417808,
	552417809,
	552417810,
	552417811,
	552417812,
	552417813,
	552417814,
	552417815,
	552417816,
	552417817,
	552417818,
	552417819,
	552417820,
	552417821,
	552417822,
	552417823,
	552417824,
	552417825,
	552417826,
	552417827,
	552417828,
	552417829,
	552417830,
	552417831,
	552417832,
	552417833,
	552417834,
	552417835,
	552417836,
	552417837,
	552417838,
	552417839,
	552417840,
	552417841,
	552417842,
	552417843,
	552417844,
	552417845,
	552417846,
	552417847,
	552417848,
	552417849,
	552417850,
	552417851,
	552417852,
	552417853,
	552417854,
	552417855,
	552417856,
	552417857,
	552417858,
	552417859,
	552417860,
	552417861,
	552417862,
	552417863,
	552417864,
	552417865,
	552417866,
	552417867,
	552417868,
	552417872,
	552417873,
	552417874,
	552417875,
	552417876,
	552417877,
	552417878,
	552417879,
	552417880,
	552417881,
	552417882,
	552417883,
	552417884,
	552417885,
	552417886,
	552417887,
	552417888,
	552417889,
	552417890,
	552417891,
	552417892,
	552417893,
	552417894,
	552417895,
	552417896,
	552417897,
	552417898,
	552417899,
	552417900,
	552417901,
	552417902,
	552417903,
	552417904,
	552417905,
	552417906,
	552417907,
	552417908,
	552417909,
	552417910,
	552417911,
	552417912,
	552417913,
	552417914,
	552417915,
	552417916,
	552417917,
	552417918,
	552417919,
	552417920,
	552417921,
	552417922,
	552417923,
	552417924,
	552417925,
	552417926,
	552417927,
	552417928,
	552417929,
	552417930,
	552417931,
	552417932,
	552417933,
	552417934,
	552417935,
	552417936,
	552417937,
	552417938,
	552417939,
	552417940,
	552417941,
	552417942,
	552417943,
	552417944,
	552417945,
	552417946,
	552417947,
	552417948,
	552417949,
	552417950,
	552417951,
	552417952,
	552417953,
	552417954,
	552417955,
	552417956,
	552417957,
	552417958,
	552417959,
	552417960,
	552417961,
	552417962,
	552417963,
	552417964,
	552417965,
	552417966,
	552417967,
	552417968,
	552417969,
	552417970,
	552417971,
	552417972,
	552417973,
	552417974,
	552417975,
	552417976,
	552417977,
	552417978,
	552417979,
	552417980,
	552417981,
	552417982,
	552417983,
	552417984,
	552417985,
	552417986,
	552417987,
	552417988,
	552417989,
	552417990,
	552417991,
	552417992,
	552417993,
	552417994,
	552417995,
	552417996,
	552417997,
	552417998,
	552417999,
	552418000,
	552418001,
	552418002,
	552418003,
	552418004,
	552418005,
	552418006,
	552418007,
	552418008,
	552418009,
	552418010,
	552418011,
	552418012,
	552418013,
	552418014,
	552418015,
	552418016,
	552418017,
	552418018,
	552418019,
	552418020,
	552418021,
	552418022,
	552418023,
	552418024,
	552418025,
	552418026,
	552418027,
	552418028,
	552418029,
	552418030,
	552418031,
	552418032,
	552418033,
	552418034,
	552418035,
	552418036,
	552418037,
	552418038,
	552418039,
	552418040,
	552418041,
	552418042,
	552418043,
	552418044,
	552418045,
	552418046,
	552418047,
	552418048,
	552418049,
	552418050,
	552418051,
	552418052,
	552418053,
	552418054,
	552418055,
	552418056,
	552418057,
	552418058,
	552418059,
	552418060,
	552418061,
	552418062,
	552418063,
	552418064,
	552418065,
	552418066,
	552418067,
	552418068,
	552418069,
	552418070,
	552418071,
	552418072,
	552418073,
	552418074,
	552418075,
	552418076,
	552418077,
	552418078,
	552418079,
	552418080,
	552418081,
	552418082,
	552418083,
	552418084,
	552418085,
	552418086,
	552418087,
	552418088,
	552418089,
	552418090,
	552418091,
	552418092,
	552418093,
	552418094,
	552418095,
	552418096,
	552418097,
	552418098,
	552418099,
	552418100,
	552418101,
	552418102,
	552418103,
	552418104,
	552418105,
	552418106,
	552418107,
	552418108,
	552418109,
	552418110,
	552418111,
	552418112,
	552418113,
	552418114,
	552418115,
	552418116,
	552418117,
	552418118,
	552418119,
	552418120,
	552418121,
	552418122,
	552418123,
	552418124,
	552418125,
	552418126,
	552418127,
	552418128,
	552418129,
	552418130,
	552418131,
	552418132,
	552418133,
	552418134,
	552418135,
	552418136,
	552418137,
	552418138,
	552418139,
	552418140,
	552418141,
	552418142,
	552418143,
	552418144,
	552418145,
	552418146,
	552418147,
	552418148,
	552418149,
	552418150,
	552418151,
	552418152,
	552418153,
	552418154,
	552418155,
	552418156,
	552418157,
	552418158,
	552418159,
	552418160,
	552418161,
	552418162,
	552418163,
	552418164,
	552418165,
	552418166,
	552418167,
	552418168,
	552418169,
	552418170,
	552418171,
	552418172,
	552418173,
	552418174,
	552418175,
	552418176,
	552418177,
	552418178,
	552418179,
	552418180,
	552418181,
	552418182,
	552418183,
	552418184,
	552418185,
	552418186,
	552418187,
	552418188,
	552418189,
	552418190,
	552418191,
	552418192,
	552418193,
	552418194,
	552418195,
	552418196,
	552418197,
	552418198,
	552418199,
	552418200,
	552418201,
	552418202,
	552418203,
	552418204,
	552418205,
	552418206,
	552418207,
	552418208,
	552418209,
	552418210,
	552418211,
	552418212,
	552418213,
	552418214,
	552418215,
	552418216,
	552418217,
	552418218,
	552418219,
	552418220,
	552418221,
	552418222,
	552418223,
	552418224,
	552418225,
	552418226,
	552418227,
	552418228,
	552418229,
	552418230,
	552418231,
	552418232,
	552418233,
	552418234,
	552418235,
	552418236,
	552418237,
	552418238,
	552418239,
	552418240,
	552418241,
	552418242,
	552418243,
	552418244,
	552418245,
	552418246,
];

/**
 * A lot of the following code was adapted from
 * https://www.hacksparrow.com/nodejs/using-node-js-to-download-files.html
 */

const command = `mkdir ${DOWNLOAD_DIR}\\`;
const child = exec(command, (err) => {
	if (err) throw err;
	downloadPhoto(0);
});

function downloadPhoto(indexNum) {
	const photoId = photoIds[indexNum];
	const photoUrl = url.parse(`${URL_BASE}/${photoId}.jpg`);
	const options = {
		host: photoUrl.host,
		path: photoUrl.path,
	};

	const fileName = photoUrl.pathname.split("/").pop();
	const file = fs.createWriteStream(`${DOWNLOAD_DIR}\\${fileName}`);

	http.get(options, (res) => {
		res
			.on("data", (data) => {
				file.write(data);
			})
			.on("end", () => {
				file.end();
				console.log(`${fileName} downloaded to ${DOWNLOAD_DIR}.`);
				indexNum++;
				if (photoIds[indexNum]) {
					const timeout = Math.floor(300 + 400 * Math.random());
					setTimeout(downloadPhoto, timeout, indexNum);
				}
			});
	});
}
